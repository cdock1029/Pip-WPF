<UserControl
    x:Class="Pip.UI.Components.Investments.InvestmentsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
    xmlns:investments="clr-namespace:Pip.UI.Components.Investments"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
    xmlns:models="clr-namespace:Pip.UI.Models"
    d:DataContext="{d:DesignInstance Type=investments:InvestmentsViewModel}"
    d:DesignHeight="400"
    d:DesignWidth="900"
    mc:Ignorable="d">

    <dxdo:DockLayoutManager>
        <dxdo:LayoutGroup Orientation="Vertical">
            <dxdo:DocumentGroup SelectedTabIndex="0" ShowDropDownButton="False">
                <dxdo:DocumentPanel Caption="Investments" x:Name="InvestmentsTab" ShowCloseButton="False">
                    <dxg:GridControl x:Name="InvestmentsGrid"
                                     ShowLoadingPanel="{Binding Investments, Converter={StaticResource ObjectToBooleanConverterInverse}}"
                                     AutoExpandAllGroups="True"
                                     DesignTimeDataObjectType="investments:InvestmentItemViewModel"
                                     SelectionMode="Row"
                                     ShowBorder="False"
                                     ItemsSource="{Binding Investments}"
                                     SelectedItem="{Binding SelectedInvestment, Mode=TwoWay}">
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:EventToCommand EventName="SelectionChanged"
                                                   Command="{Binding DetailsViewModel.HandleSelectedInvestmentChangedCommand}"
                                                   CommandParameter="{Binding ElementName=InvestmentsGrid, Path=SelectedItem}" />
                        </dxmvvm:Interaction.Behaviors>
                        <dxg:GridControl.View>
                            <dxg:TableView
                                x:Name="InvestmentsGridTable"
                                AllowBestFit="True"
                                AllowGrouping="True"
                                AllowScrollAnimation="True"
                                NewItemRowPosition="None"
                                ShowUpdateRowButtons="OnCellValueChange"
                                EditFormShowMode="None"
                                AutoWidth="True"
                                IsTotalSummaryMenuEnabled="True"
                                ShowGroupedColumns="False"
                                ValidateRowCommand="{Binding ValidateRowCommand}"
                                ValidateRowDeletionCommand="{Binding ValidateRowDeletionCommand}"
                                DataSourceRefreshCommand="{Binding DataSourceRefreshCommand}"
                                ShowFixedTotalSummary="True">
                                <dxg:TableView.RowCellMenuCustomizations>
                                    <dxb:BarButtonItem Content="Delete..."
                                                       Glyph="{dx:DXImage 'SvgImages/Outlook Inspired/Delete.svg'}">
                                        <dxmvvm:Interaction.Behaviors>
                                            <dxmvvm:ConfirmationBehavior
                                                Command="{Binding ElementName=InvestmentsGridTable, Path=Commands.DeleteFocusedRow}"
                                                EnableConfirmationMessage="True"
                                                MessageIcon="Exclamation"
                                                MessageButton="YesNo"
                                                MessageText="Confirm Delete?" />
                                        </dxmvvm:Interaction.Behaviors>
                                    </dxb:BarButtonItem>
                                </dxg:TableView.RowCellMenuCustomizations>
                            </dxg:TableView>
                        </dxg:GridControl.View>
                        <dxg:GridControl.InputBindings>
                            <KeyBinding Key="Delete">
                                <dxmvvm:Interaction.Behaviors>
                                    <dxmvvm:ConfirmationBehavior
                                        Command="{Binding ElementName=InvestmentsGridTable, Path=Commands.DeleteFocusedRow}"
                                        EnableConfirmationMessage="True"
                                        MessageIcon="Exclamation"
                                        MessageButton="YesNo"
                                        MessageText="Confirm Delete?" />
                                </dxmvvm:Interaction.Behaviors>
                            </KeyBinding>
                        </dxg:GridControl.InputBindings>
                        <dxg:GridControl.TotalSummary>
                            <dxg:GridSummaryItem
                                DisplayFormat="Total: {0:c}"
                                Alignment="Right"
                                FieldName="Par"
                                SummaryType="Sum" />
                        </dxg:GridControl.TotalSummary>
                        <dxg:GridControl.GroupSummary>
                            <dxg:GridSummaryItem
                                DisplayFormat="{}{0:c}"
                                FieldName="Par"
                                SummaryType="Sum" />
                        </dxg:GridControl.GroupSummary>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn
                                AllowEditing="False"
                                FieldName="Cusip"
                                Header="CUSIP" />
                            <dxg:GridColumn
                                AllowEditing="False"
                                FieldName="IssueDate"
                                Header="Issue Date" />
                            <dxg:GridColumn
                                AllowEditing="False"
                                FieldName="MaturityDate"
                                Header="Maturity Date" />
                            <dxg:GridColumn
                                AllowEditing="False"
                                FieldName="Term"
                                SortFieldName="TermSpan" />
                            <dxg:GridColumn
                                AllowEditing="False"
                                FieldName="Type"
                                GroupIndex="0">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:ComboBoxEditSettings
                                        ItemsSource="{dxe:EnumItemsSource EnumType=models:TreasuryType}" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn AllowCellMerge="False"
                                            AllowEditing="True"
                                            FieldName="Par">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings DisplayFormat="c" Mask="c" MaskType="Numeric" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                        </dxg:GridControl.Columns>
                    </dxg:GridControl>

                </dxdo:DocumentPanel>
            </dxdo:DocumentGroup>
        </dxdo:LayoutGroup>
    </dxdo:DockLayoutManager>
</UserControl>