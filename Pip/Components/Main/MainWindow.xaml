<dx:ThemedWindow
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
    xmlns:navigation="http://schemas.devexpress.com/winfx/2008/xaml/windowsui/navigation"
    xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
    xmlns:dxa="http://schemas.devexpress.com/winfx/2008/xaml/accordion"
    xmlns:main="clr-namespace:Pip.UI.Components.Main"
    xmlns:shared="clr-namespace:Pip.UI.Components.Shared"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
    xmlns:native="http://schemas.devexpress.com/winfx/2008/xaml/core/internal"
    xmlns:utils="clr-namespace:Pip.UI.Utils"
    x:Class="Pip.UI.Components.Main.MainWindow"
    Width="600"
    Height="600"
    d:DataContext="{d:DesignInstance Type={x:Type main:MainViewModel}}"
    WindowStartupLocation="CenterScreen"
    UseLayoutRounding="True"
    SnapsToDevicePixels="True"
    ShowLeftPanel="True"
    mc:Ignorable="d"
    dx:DXSerializer.Enabled="True"
    dx:WindowRestoreLayoutOptions.AllowRestoreStateForDisplayedWindow="True">

    <dxmvvm:Interaction.Behaviors>

        <dx:DialogService DialogWindowStartupLocation="CenterOwner">
            <dx:DialogService.DialogStyle>
                <Style TargetType="dx:ThemedWindow">
                    <Setter Property="Width" Value="400" />
                    <Setter Property="SizeToContent" Value="Height" />
                    <Setter Property="UseLayoutRounding" Value="True" />
                    <Setter Property="ControlBoxButtonSet" Value="Close" />
                    <Setter Property="ResizeMode" Value="NoResize" />
                    <Setter Property="SnapsToDevicePixels" Value="True" />
                </Style>
            </dx:DialogService.DialogStyle>
        </dx:DialogService>

    </dxmvvm:Interaction.Behaviors>

    <dx:ThemedWindow.Resources>
        <Style TargetType="{x:Type Image}">
            <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality" />
        </Style>
        <dxmvvm:ObjectToObjectConverter x:Key="PanelMinWidthConverter" DefaultTarget="220">
            <dxmvvm:MapItem Source="False" Target="20" />
        </dxmvvm:ObjectToObjectConverter>
    </dx:ThemedWindow.Resources>

    <dx:ThemedWindow.ToolbarItems>
        <dxb:MainMenuControl VerticalAlignment="Center" ShowBackground="False">
            <dxb:BarSubItem Content="_File">
                <dxb:BarButtonItem x:Name="BtnNew" Content="_New" Glyph="{dx:DXImage Image=New_32x32.png}"
                                   Command="{Binding ShowFormCommand}" />
                <dxb:BarButtonItem x:Name="BtnOpen" Content="_Open" Glyph="{dx:DXImage Image=Open_32x32.png}" />
                <dxb:BarButtonItem Content="_Quit" Glyph="{dx:DXImage SvgImages/XAF/Action_Close.svg}">
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="ItemClick">
                            <b:CallMethodAction MethodName="Close"
                                                TargetObject="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}, Mode=FindAncestor}}" />
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </dxb:BarButtonItem>
            </dxb:BarSubItem>
            <dxb:BarSubItem Content="_Edit">
                <dxb:BarButtonItem x:Name="BtnCut" Content="Cu_t" Glyph="{dx:DXImage Image=Cut_32x32.png}" />
                <dxb:BarButtonItem x:Name="BtnCopy" Content="_Copy" Glyph="{dx:DXImage Image=Copy_32x32.png}" />
                <dxb:BarButtonItem x:Name="BtnPaste" Content="_Paste" Glyph="{dx:DXImage Image=Paste_32x32.png}" />
            </dxb:BarSubItem>
        </dxb:MainMenuControl>
    </dx:ThemedWindow.ToolbarItems>

    <dx:ThemedWindow.HeaderItems>
        <Grid FocusManager.IsFocusScope="True">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="110" />
            </Grid.ColumnDefinitions>
            <dxe:ButtonEdit VerticalAlignment="Center" x:Name="ButtonEdit"
                            NullText="Search CUSIP"
                            Text="{Binding SearchViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            IsKeyboardFocusWithinChanged="ButtonEdit_OnIsKeyboardFocusWithinChanged"
                            AllowDefaultButton="False"
                            AllowFocusEditorButtons="True">
                <dxe:ButtonEdit.Buttons>
                    <dxe:ButtonInfo GlyphKind="Cancel" ToolTip="Clear"
                                    Command="{Binding SearchViewModel.ClearCommand}"
                                    Visibility="{Binding SearchViewModel.SearchText, Converter={dxmvvm:StringToVisibilityConverter HiddenInsteadOfCollapsed=True}}" />
                    <dxe:ButtonInfo x:Name="Search" GlyphKind="Search" ToolTipService.ToolTip="Search">
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:CompositeCommandBehavior CanExecuteCondition="AllCommandsCanBeExecuted">
                                <dxmvvm:CommandItem Command="{Binding  SearchViewModel.SearchCommand}" />
                                <dxmvvm:CommandItem
                                    Command="{Binding Source={x:Reference FlyoutControl}, Path=OpenCommand}" />
                            </dxmvvm:CompositeCommandBehavior>
                        </dxmvvm:Interaction.Behaviors>
                    </dxe:ButtonInfo>
                </dxe:ButtonEdit.Buttons>
                <dxe:ButtonEdit.InputBindings>
                    <KeyBinding Key="Return">
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:CompositeCommandBehavior CanExecuteCondition="AllCommandsCanBeExecuted">
                                <dxmvvm:CommandItem Command="{Binding  SearchViewModel.SearchCommand}" />
                                <dxmvvm:CommandItem
                                    Command="{Binding Source={x:Reference FlyoutControl}, Path=OpenCommand}" />
                            </dxmvvm:CompositeCommandBehavior>
                        </dxmvvm:Interaction.Behaviors>
                    </KeyBinding>
                </dxe:ButtonEdit.InputBindings>
            </dxe:ButtonEdit>
            <Border Grid.Column="1" Background="Transparent" native:WindowChrome.IsHitTestVisibleInChrome="False" />
            <dxe:FlyoutControl Grid.Column="0" x:Name="FlyoutControl"
                               PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=Children[0]}"
                               AllowMoveAnimation="False"
                               AnimationDuration="0:0:0.0"
                               Closing="FlyoutControl_OnClosing"
                               MinHeight="80"
                               MaxHeight="300" Width="220">
                <dxe:FlyoutControl.Settings>
                    <dxe:FlyoutSettings Placement="Bottom" />
                </dxe:FlyoutControl.Settings>
                <Grid>
                    <TextBlock Text="No results" Margin="4">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SearchViewModel.SearchResults.Count}" Value="0">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <dxe:ListBoxEdit x:Name="SearchResultsList" VerticalAlignment="Top"
                                     ItemsSource="{Binding SearchViewModel.SearchResults}">
                        <dxe:ListBoxEdit.Style>
                            <Style TargetType="dxe:ListBoxEdit">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SearchViewModel.SearchResults}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SearchViewModel.SearchResults.Count}" Value="0">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </dxe:ListBoxEdit.Style>
                    </dxe:ListBoxEdit>
                </Grid>
            </dxe:FlyoutControl>
        </Grid>
    </dx:ThemedWindow.HeaderItems>

    <dx:ThemedWindow.LeftPanelContent>

        <dxa:AccordionControl
            x:Name="NavAccordion"
            native:WindowChrome.IsHitTestVisibleInChrome="True"
            Margin="5,0,0,0"
            MinWidth="{Binding RelativeSource={RelativeSource Self}, Path=IsExpanded, Converter={StaticResource PanelMinWidthConverter}}"
            CompactNavigation="False"
            IsCollapseButtonVisible="True"
            CollapsedItemDisplayMode="ContentAndGlyph"
            SummaryItemGlyph="{dx:DXImage 'SvgImages/Icon Builder/Actions_NavigationBar.svg'}"
            SummaryItemGlyphSize="16,16"
            SummaryItemHeader="Navigation"
            CollapsedItemClickAction="Select"
            ExpandItemOnHeaderClick="False"
            ShowPopupOnHover="True"
            RootItemExpandButtonPosition="None"
            RootItemDisplayMode="Group"
            ViewMode="Accordion"
            ItemsSource="{Binding Routes}"
            SelectedItem="{Binding SelectedRoute, Mode=TwoWay}"
            AutoExpandAllItems="True">

            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="SelectedItemChanged"
                                       Command="{Binding NavigateToSelectedCommand}" />
            </dxmvvm:Interaction.Behaviors>

            <dxa:AccordionControl.ItemContainerStyle>
                <Style TargetType="{x:Type dxa:AccordionItem}">
                    <d:Style.DataContext>
                        <x:Type Type="shared:IPipRoute" />
                    </d:Style.DataContext>
                    <Setter Property="Header" Value="{Binding Title}" />
                    <Setter Property="Glyph" Value="{Binding Image}" />
                    <Setter Property="FontSize" Value="14" />
                    <Setter Property="FontWeight" Value="SemiBold" />

                    <Setter Property="GlyphTemplate">
                        <Setter.Value>
                            <DataTemplate>
                                <Image Height="18" Width="18" Source="{Binding}" Margin="6,0,8,0" />
                            </DataTemplate>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <DataTrigger
                            Binding="{DXBinding '@s.($dx:LightweightThemeManager.CurrentTheme).Name.Contains(`Win11`)'}"
                            Value="True">
                            <Setter Property="GlyphTemplate">
                                <Setter.Value>
                                    <DataTemplate>
                                        <Image Height="20" Width="20" Source="{Binding}" Margin="6,4" />
                                    </DataTemplate>
                                </Setter.Value>
                            </Setter>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </dxa:AccordionControl.ItemContainerStyle>
        </dxa:AccordionControl>
    </dx:ThemedWindow.LeftPanelContent>

    <dxwui:NavigationFrame AllowMerging="True"
                           NavigationCacheMode="Required"
                           AnimationType="None"
                           Margin="5, 20, 5,5"
                           FocusManager.IsFocusScope="True">
        <dxmvvm:Interaction.Behaviors>
            <navigation:FrameNavigationService />
        </dxmvvm:Interaction.Behaviors>
    </dxwui:NavigationFrame>
</dx:ThemedWindow>